---
alwaysApply: true
---

Follow steps in strict order. Do not skip steps.

## 1. Functional Tests (Gate)

Write black-box functional tests that **separate buggy vs correct behavior**.

Rules:
- Treat the system as a black box
- Use only public inputs and observable outputs
- No implementation details
- No redundant assertions
- No mocks unless required by the public interface

Method:
- Form multiple root-cause hypotheses
- Find the **smallest observable behavior** that differs
- Encode only that behavior
- Tests MUST fail on the current bug and pass once fixed

Output:
- Runnable test code only
- If no separating test exists, explicitly state so

## 2. Minimal Fix (80% Rule)

Implement the **simplest correct solution** that makes all tests pass.

Rules:
- Solve the core 80% first
- Prefer standard library and idiomatic patterns
- No speculative abstractions
- No premature optimization

## 3. Architecture Cleanup

After tests pass:
- Modularize only where duplication or coupling exists
- Split files >256 lines
- Split methods >64 lines
- Keep logs <256 characters

## 4. Code Quality Gate

- Clean, readable code
- No comments
- All @/git_hooks/pre-push checks must pass
- Also fix any pre-existing pre-push failures

## 5. Output Discipline

- Prefix every message with `TDD2: `
- Max 256 characters per message